<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mappers.UsersMapper">


	<!-- 컬럼(column)변수($), 데이터 변수(#) -->
	<sql id="search">
		<choose>
			<when test = "searchOpt == 'all' ">
				WHERE userID LIKE CONCAT('%',#{words},'%')
				OR userName LIKE CONCAT('%',#{words},'%')
				OR userEmail LIKE CONCAT('%',#{words},'%')
			</when>
		
			<otherwise>
				WHERE ${searchOpt} LIKE CONCAT('%',#{words},'%')
			</otherwise>
		</choose>
	</sql>


	<!-- register 회원가입 입력하는 부분 -->
	<insert id ="setUser">
		INSERT INTO	
			users
		SET
			userID = #{userID},
			passwd = #{passwd},
			department = #{department},
			userRank = #{userRank},	
			userName = #{userName},
			userEmail = #{userEmail},
			userPhone = #{userPhone},
			userRegdate = now()
	
	</insert>
	
<!-- 	그룹웨어 로그인하기 -->
	
	<select id="loginCheck" resultType="uservo">
	
		SELECT userID, userName, auth FROM users
		WHERE userID = #{userID} AND passwd = #{passwd}
	
<!-- 		SELECT userID, userName, auth FROM users -->
<!-- 		WHERE userID = 'admin' AND passwd = '1111' -->
	
	</select>
	
<!-- idCheck(ajax) 회원가입 아이디확인하는 부분-->
	<select id="idCheck" resultType="int">
		SELECT COUNT(*) FROM users WHERE userID = #{userID}
	</select>
	
<!-- getUsersList 결과 가지고 오는 부분 -->
	<select id="getUsersList"  resultType="uservo">
		SELECT 
			uid, userID, auth, userName, userEmail, department, userRank, date_format(userRegdate,'%Y-%m-%d') as userRegdate
		FROM users
	
	 		<include refid="search"></include>
		
		 ORDER BY uid DESC limit #{start}, #{end}
	
	</select>
	
	<select id="getUsersCount" resultType="int">
		SELECT COUNT(*) FROM users
			<include refid="search"></include>
	</select>	
	
	
</mapper>